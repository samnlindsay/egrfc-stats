<!DOCTYPE html>

<html lang="en">

<head>
    <title>EGRFC Stats</title>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="styles.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:800" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans+Narrow" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Oswald:200,400,600" rel="stylesheet" />
</head>

<body>
    <div class="container text-center overflow-visible" style="width:100%; max-width: 100%">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark col-12 position-fixed top-0 p-0" style="display: none;">
            <div class="container-fluid p-2">
                <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"
                    class="navbar-toggler" data-bs-target="#navbarNav" data-bs-toggle="collapse" type="button">
                    <span class="navbar-toggler-icon"></span>
                    EGRFC Stats
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="index.html" onclick="showHomePage(event)">Home</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#"
                                id="navbarDropdownTeam" role="button">Team Stats</a>
                            <ul aria-labelledby="navbarDropdownTeam" class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"
                                        onclick="loadPage('Charts/results.html')">Results by Game</a></li>
                                <li><a class="dropdown-item" href="#" onclick="loadPage('Charts/video_analysis.html')">Video
                                        Analysis by Game</a></li>
                                <li><a class="dropdown-item" href="#" onclick="loadPage('Charts/set-piece.html')">Set
                                        Piece Results by Game</a></li>
                                <li><a class="dropdown-item" href="#" onclick="loadPage('Charts/lineouts.html')">Lineout
                                        Analysis</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#"
                                id="navbarDropdownPlayer" role="button">Player Stats</a>
                            <ul aria-labelledby="navbarDropdownPlayer" class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"
                                        onclick="loadPage('Charts/appearances.html')">Appearances</a></li>
                                <li><a class="dropdown-item" href="#" onclick="loadPage('Charts/positions.html')">Starts
                                        by Position</a></li>
                                <li><a class="dropdown-item" href="#"
                                        onclick="loadPage('Charts/captains.html')">Captains</a></li>
                                <li><a class="dropdown-item" href="#"
                                        onclick="loadPage('Charts/points.html')">Scorers</a></li>
                                <li><a class="dropdown-item" href="#" onclick="loadPage('Charts/cards.html')">Cards</a>
                                <li><a class="dropdown-item" href="#" onclick="loadPage('Charts/team-sheets.html')">Team
                                        Sheets</a></li>
                        </li>
                    </ul>
                    </li>
                    </ul>
                </div>
            </div>
        </nav>


        <div class="container d-flex align-items-center justify-content-center" id="home-content"
            style="width:100%; max-width: 100%; height:100%">
            <div class="text-center">
                <img src="img/logo.png" alt="EGRFC Logo" class="mb-2" style="max-width: 200px; height: auto;">
                <h1>East Grinstead RFC Stats</h1>
                <span style="font-family: 'Lato', sans-serif; font-weight: 300; font-size: 1rem;">Select a section below to view summary statistics and various charts.</span>
            </div>

            <div class="container-fluid">
                <div class="mb-4">
                    <button class="btn btn-primary w-100 text-center" type="button" data-bs-toggle="collapse"
                        data-bs-target="#resultsSummary" aria-expanded="false">
                        Results Summary
                    </button>
                    <div class="collapse mt-2 show justify-content-center align-items-center" id="resultsSummary">
                        <table class="table table-borderless text-center align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th rowspan="2">
                                        <select class="form-select m-0" id="seasonSelect1" onchange="updateTable()"
                                            style="width: min-content;">
                                            <option value="2024/25">2024/25</option>
                                            <option value="2023/24">2023/24</option>
                                            <option value="2022/23">2022/23</option>
                                            <option value="2021/22">2021/22</option>
                                        </select>
                                    </th>
                                    <th class="align-middle py-1" rowspan="2">Games</th>
                                    <th class="align-middle py-1" rowspan="2">Won</th>
                                    <th class="align-middle py-1" rowspan="2">Lost</th>
                                    <th class="align-middle py-0 my-0" colspan="2">Average</th>
                                </tr>
                                <tr>
                                    <th class="align-middle py-0 mx-0 small">PF</th>
                                    <th class="align-middle py-0 mx-0 small">PA</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="row1">
                                    <td class="align-middle py-1" id="squad1">1st XV</td>
                                    <td class="align-middle py-1" id="played1">18</td>
                                    <td class="align-middle py-1" id="won1">3</td>
                                    <td class="align-middle py-1" id="lost1">15</td>
                                    <td class="align-middle py-1 small" id="pf1">17.0</td>
                                    <td class="align-middle py-1 small" id="pa1">30.4</td>
                                </tr>
                                <tr id="row2">
                                    <td class="align-middle py-1" id="squad2">2nd XV</td>
                                    <td class="align-middle py-1" id="played2">15</td>
                                    <td class="align-middle py-1" id="won2">8</td>
                                    <td class="align-middle py-1" id="lost2">7</td>
                                    <td class="align-middle py-1 small" id="pf2">20.9</td>
                                    <td class="align-middle py-1 small" id="pa2">21.6</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="d-flex justify-content-end align-items-center">
                            <h4 class="me-3">Charts:</h4>
                            <div class="btn-group">
                                <button class="btn custom-btn py-2" onclick="loadPage('Charts/results.html')">Results by
                                    Game</button>
                                <button class="btn custom-btn py-2" onclick="loadPage('Charts/video_analysis.html')">Video
                                    Analysis by Game</button>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="my-4">
                <div class="mb-4">
                    <button class="btn btn-primary w-100 text-center" type="button" data-bs-toggle="collapse"
                        data-bs-target="#setPieceSummary" aria-expanded="false">
                        Scrums & Lineouts
                    </button>
                    <div class="collapse mt-2 justify-content-center align-items-center" id="setPieceSummary">
                        <table class="table table-borderless text-center align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th rowspan="2" colspan="2" class="align-middle py-0 my-0">
                                        <select class="form-select" id="seasonSelect2" onchange="updateTable()"
                                            style="width: min-content;">
                                            <option value="2024/25">2024/25</option>
                                            <option value="2023/24">2023/24</option>
                                            <option value="2022/23">2022/23</option>
                                            <option value="2021/22">2021/22</option>
                                        </select>
                                    </th>
                                    <th class="align-middle py-0 m-0 small br" rowspan="2" style="line-height: 1.0;">
                                        Games on
                                        video</th>
                                    <th class="align-middle eg-header br" colspan="2">EG</th>
                                    <th class="align-middle opp-header br" colspan="2">Opposition</th>
                                    <th class="align-middle" colspan="2">Turnovers</th>
                                </tr>
                                <tr>
                                    <th class="align-middle py-2 small m-0 eg-header" style="line-height:0.8;">Avg per
                                        game</th>
                                    <th class="align-middle py-2 small m-0 eg-header br" style="line-height:0.8;">Avg
                                        Success</th>
                                    <th class="align-middle py-2 small m-0 opp-header" style="line-height:0.8;">Avg per
                                        game</th>
                                    <th class="align-middle py-2 small m-0 opp-header br" style="line-height:0.8;">Avg
                                        Success</th>
                                    <th class="align-middle py-2 small m-0 eg-header" style="line-height:0.8;">Avg Won</th>
                                    <th class="align-middle py-2 small m-0 opp-header" style="line-height:0.8;">Avg Lost</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="row1" style="border-top: 2px solid black">
                                    <td class="align-middle py-1" rowspan="2" id="squad1">1st XV</td>
                                    <td class="align-middle py-1" style="font-family: 'PT Sans Narrow', sans-serif;">
                                        Scrum</td>
                                    <td class="br" rowspan="2" id="games1"></td>
                                    <td class="align-middle small py-1" id="eg_n1s"></td>
                                    <td class="align-middle py-1 br" id="eg_success1s"></td>
                                    <td class="align-middle small py-1 opp" id="opp_n1s"></td>
                                    <td class="align-middle py-1 opp br" id="opp_success1s"></td>
                                    <td class="align-middle py-1" id="t_won1s"></td>
                                    <td class="align-middle py-1 opp" id="t_lost1s"></td>
                                </tr>
                                <tr id="row1">
                                    <td class="align-middle py-1" style="font-family: 'PT Sans Narrow', sans-serif;">Lineout</td>
                                    <td class="align-middle small py-1" id="eg_n1l"></td>
                                    <td class="align-middle py-1 br" id="eg_success1l"></td>
                                    <td class="align-middle small py-1 opp" id="opp_n1l"></td>
                                    <td class="align-middle py-1 opp br" id="opp_success1l"></td>
                                    <td class="align-middle py-1" id="t_won1l"></td>
                                    <td class="align-middle py-1 opp" id="t_lost1l"></td>
                                </tr>
                                <tr id="row2">
                                    <td class="align-middle py-1" rowspan="2" id="squad2">2nd XV</td>
                                    <td class="align-middle py-1" style="font-family: 'PT Sans Narrow', sans-serif;">Scrum</td>
                                    <td class="br" rowspan="2" id="games2"></td>
                                    <td class="align-middle small py-1" id="eg_n2s"></td>
                                    <td class="align-middle py-1 br" id="eg_success2s"></td>
                                    <td class="align-middle small py-1 opp" id="opp_n2s"></td>
                                    <td class="align-middle py-1 opp br" id="opp_success2s"></td>
                                    <td class="align-middle py-1" id="t_won2s"></td>
                                    <td class="align-middle py-1 opp" id="t_lost2s"></td>
                                </tr>
                                <tr id="row2">
                                    <td class="align-middle py-1" style="font-family: 'PT Sans Narrow', sans-serif;">Lineout</td>
                                    <td class="align-middle small py-1" id="eg_n2l"></td>
                                    <td class="align-middle py-1 br" id="eg_success2l"></td>
                                    <td class="align-middle small py-1 opp" id="opp_n2l"></td>
                                    <td class="align-middle py-1 opp br" id="opp_success2l"></td>
                                    <td class="align-middle py-1" id="t_won2l"></td>
                                    <td class="align-middle py-1 opp" id="t_lost2l"></td>

                            </tbody>
                        </table>
                        <div class="d-flex justify-content-end align-items-center">
                            <h4 class="me-3">Charts:</h4>
                            <div class="btn-group">
                                <button class="btn custom-btn py-2" onclick="loadPage('Charts/set-piece.html')">Results
                                    by
                                    Game</button>
                                <button class="btn custom-btn py-2" onclick="loadPage('Charts/lineouts.html')">Lineout
                                    Analysis</button>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="my-4">
                <div class="mb-4">
                    <button class="btn btn-primary w-100 text-center" type="button" data-bs-toggle="collapse"
                        data-bs-target="#playerStats" aria-expanded="false">
                        Player Stats
                    </button>
                    <div class="collapse mt-2 justify-content-center align-items-center" id="playerStats">
                        <table class="table table-borderless text-center align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th>
                                        <select class="form-select m-0" id="seasonSelect3" onchange="updateTable()" style="width: min-content;">
                                            <option value="2024/25">2024/25</option>
                                            <option value="2023/24">2023/24</option>
                                            <option value="2022/23">2022/23</option>
                                            <option value="2021/22">2021/22</option>
                                        </select>
                                    </th>
                                    <th class="align-middle small py-1" style="line-height:0.8; width:min-content;">Total Players Selected</th>
                                    <th class="align-middle small py-1">Most Appearances</th>
                                    <th class="align-middle small py-1">Most Tries</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="row1">
                                    <td class="align-middle py-1" id="squad1">1st XV</td>
                                    <td class="align-middle py-1" id="players1"></td>
                                    <td class="align-middle small py-1" id="apps1"></td>
                                    <td class="align-middle small py-1" id="tries1"></td>
                                </tr>
                                <tr id="row2">
                                    <td class="align-middle py-1" id="squad2">2nd XV</td>
                                    <td class="align-middle py-1" id="players2"></td>
                                    <td class="align-middle small py-1" id="apps2"></td>
                                    <td class="align-middle small py-1" id="tries2"></td>
                                </tr>
                                <tr id="rowT" class="table-dark" style="border-top: 2px solid black">
                                    <td class="align-middle py-1" id="squadT">Overall</td>
                                    <td class="align-middle py-1" id="playersT"></td>
                                    <td class="align-middle small py-1" id="appsT"></td>
                                    <td class="align-middle small py-1" id="triesT"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="d-flex justify-content-end align-items-center">
                            <h4 class="me-3">Charts:</h4>
                            <div class="btn-group-vertical">
                                <button class="btn custom-btn" onclick="loadPage('Charts/appearances.html')">Total
                                    Appearances</button>
                                <button class="btn custom-btn" onclick="loadPage('Charts/positions.html')">Starts by
                                    Position</button>
                                <button class="btn custom-btn" onclick="loadPage('Charts/team-sheets.html')">Team
                                    Sheets</button>
                                    </div>  
                            <div class="btn-group-vertical">
                                <button class="btn custom-btn"
                                    onclick="loadPage('Charts/captains.html')">Captains</button>
                                <button class="btn custom-btn" onclick="loadPage('Charts/points.html')">Scorers</button>
                                <button class="btn custom-btn" onclick="loadPage('Charts/cards.html')">Cards</button>
                            </div>
                        </div>
                    </div>
                </div>
                <hr> 
            </div>
            
        </div>


        <!-- Placeholder for dynamic content -->
        <div class="iframe-container hidden" id="dynamic-content">
            <iframe id="chart-frame"
                style="width: 100%; height: 100%; border: none; background-color: whitesmoke;"></iframe>
        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadPage(url) {
            console.log("Loading page:", url);

            document.querySelector('nav.navbar').style.display = 'block';

            let homeContent = document.getElementById('home-content');
            homeContent.classList.add("hidden");

            let dynamicContent = document.getElementById('dynamic-content');
            dynamicContent.classList.remove("hidden");

            let iframe = document.getElementById('chart-frame');
            iframe.src = url;

            // Close navbar if open
            let navbarToggler = document.querySelector('.navbar-toggler');
            if (navbarToggler.getAttribute('aria-expanded') === 'true') {
                navbarToggler.click();
            }
        }

        function showHomePage(event) {
            event.preventDefault();
            console.log("Returning to home page");

            // Hide the navbar
            document.querySelector('nav.navbar').style.display = 'none';

            // Show home-content
            let homeContent = document.getElementById('home-content');
            homeContent.classList.remove("hidden");

            // Hide dynamic content
            let dynamicContent = document.getElementById('dynamic-content');
            dynamicContent.classList.add("hidden");
        }

        function updateTable() {
            const selectedSeason1 = document.getElementById("seasonSelect1").value;
            const selectedSeason2 = document.getElementById("seasonSelect2").value;
            const selectedSeason3 = document.getElementById("seasonSelect3").value;

            // Season summary table
            fetch("data/season_summaries.json")
                .then(response => response.json())
                // Filter data for selected season (key = "2024-25", value = { "1st": {...}, "2nd": {...} })
                .then(data => data[selectedSeason1])
                .then(data => {
                    console.log(data);
                    document.getElementById("played1").innerText = data["1st"].Played;
                    document.getElementById("won1").innerText = data["1st"].Won.toFixed(0)
                    document.getElementById("lost1").innerText = data["1st"].Lost;
                    document.getElementById("pf1").innerText = data["1st"].Avg_PF.toFixed(1);
                    document.getElementById("pa1").innerText = data["1st"].Avg_PA.toFixed(1);

                    document.getElementById("played2").innerText = data["2nd"].Played;
                    document.getElementById("won2").innerText = data["2nd"].Won;
                    document.getElementById("lost2").innerText = data["2nd"].Lost;
                    document.getElementById("pf2").innerText = data["2nd"].Avg_PF.toFixed(1);
                    document.getElementById("pa2").innerText = data["2nd"].Avg_PA.toFixed(1);
                }
                );

            // Set piece table
            fetch("data/set_piece_summaries.json")
                .then(response => response.json())
                .then(data => data[selectedSeason2])
                .then(data => {
                    console.log(data);
                    // 1st XV Lineout
                    document.getElementById("games1").innerText = data["1st"]["Lineout"].count;
                    document.getElementById("eg_n1l").innerText = data["1st"]["Lineout"].EG_total.toFixed(1);
                    document.getElementById("eg_success1l").innerText = (data["1st"]["Lineout"].EG_success * 100).toFixed(0) + "%";
                    document.getElementById("opp_n1l").innerText = data["1st"]["Lineout"].Opp_total.toFixed(1);
                    document.getElementById("opp_success1l").innerText = (data["1st"]["Lineout"].Opp_success * 100).toFixed(0) + "%";
                    document.getElementById("t_won1l").innerText = data["1st"]["Lineout"].T_won.toFixed(1);
                    document.getElementById("t_lost1l").innerText = data["1st"]["Lineout"].T_lost.toFixed(1);

                    // 1st XV Scrum
                    document.getElementById("eg_n1s").innerText = data["1st"]["Scrum"].EG_total.toFixed(1);
                    document.getElementById("eg_success1s").innerText = (data["1st"]["Scrum"].EG_success * 100).toFixed(0) + "%";
                    document.getElementById("opp_n1s").innerText = data["1st"]["Scrum"].Opp_total.toFixed(1);
                    document.getElementById("opp_success1s").innerText = (data["1st"]["Scrum"].Opp_success * 100).toFixed(0) + "%";
                    document.getElementById("t_won1s").innerText = data["1st"]["Scrum"].T_won.toFixed(1);
                    document.getElementById("t_lost1s").innerText = data["1st"]["Scrum"].T_lost.toFixed(1);

                    // 2nd XV Lineout
                    document.getElementById("games2").innerText = data["2nd"]["Lineout"].count;
                    document.getElementById("eg_n2l").innerText = data["2nd"]["Lineout"].EG_total.toFixed(1);
                    document.getElementById("eg_success2l").innerText = (data["2nd"]["Lineout"].EG_success * 100).toFixed(0) + "%";
                    document.getElementById("opp_n2l").innerText = data["2nd"]["Lineout"].Opp_total.toFixed(1);
                    document.getElementById("opp_success2l").innerText = (data["2nd"]["Lineout"].Opp_success * 100).toFixed(0) + "%";
                    document.getElementById("t_won2l").innerText = data["2nd"]["Lineout"].T_won.toFixed(1);
                    document.getElementById("t_lost2l").innerText = data["2nd"]["Lineout"].T_lost.toFixed(1);

                    // 2nd XV Scrum
                    document.getElementById("eg_n2s").innerText = data["2nd"]["Scrum"].EG_total.toFixed(1);
                    document.getElementById("eg_success2s").innerText = (data["2nd"]["Scrum"].EG_success * 100).toFixed(0) + "%";
                    document.getElementById("opp_n2s").innerText = data["2nd"]["Scrum"].Opp_total.toFixed(1);
                    document.getElementById("opp_success2s").innerText = (data["2nd"]["Scrum"].Opp_success * 100).toFixed(0) + "%";
                    document.getElementById("t_won2s").innerText = data["2nd"]["Scrum"].T_won.toFixed(1);
                    document.getElementById("t_lost2s").innerText = data["2nd"]["Scrum"].T_lost.toFixed(1);

                }
                );

            // Top players table
            fetch("data/top_players.json")
                .then(response => response.json())
                .then(data => data[selectedSeason3])
                .then(data => {
                    console.log(data);
                    document.getElementById("players1").innerText = data["1st"].PlayersUsed;
                    document.getElementById("apps1").innerText = data["1st"].Players_A;
                    document.getElementById("tries1").innerText = data["1st"].Players_T;
                    document.getElementById("players2").innerText = data["2nd"].PlayersUsed;
                    document.getElementById("apps2").innerText = data["2nd"].Players_A;
                    document.getElementById("tries2").innerText = data["2nd"].Players_T;
                    document.getElementById("playersT").innerText = data["Total"].PlayersUsed;
                    document.getElementById("appsT").innerText = data["Total"].Players_A;
                    document.getElementById("triesT").innerText = data["Total"].Players_T;
                }
                );
        }

        document.addEventListener("DOMContentLoaded", function () {
            const iframe = document.getElementById("chart-frame");

            function getScaleFactor() {
                if (window.innerWidth <= 480) {
                    return 0.7; // Mobile
                } else if (window.innerWidth <= 768) {
                    return 0.8; // Tablet
                } else {
                    return 1; // Desktop (no scaling)
                }
            }

            function applyScaling() {
                const scaleFactor = getScaleFactor();

                // Ensure iframe takes full width
                iframe.style.width = "100%";
                iframe.style.height = "100%";

                // Wait for the iframe to load
                iframe.onload = function () {
                    const iframeDoc = iframe.contentWindow.document;
                    const vegaEmbed = iframeDoc.querySelector('.vega-embed');

                    if (vegaEmbed) {
                        // Apply scale factor to the vega-embed element
                        vegaEmbed.style.width = `${100 * scaleFactor}%`;
                    }
                };
            }

            updateTable();

            // Apply scaling on initial load
            applyScaling();

            // Apply scaling when the window is resized
            window.addEventListener("resize", applyScaling);

            const collapsibleButtons = document.querySelectorAll("[data-bs-toggle='collapse']");

            collapsibleButtons.forEach(button => {
                button.addEventListener("click", function () {
                    const targetId = this.getAttribute("data-bs-target");

                    // Close all collapsible sections except the clicked one
                    document.querySelectorAll(".collapse.show").forEach(openSection => {
                        if ("#" + openSection.id !== targetId) {
                            new bootstrap.Collapse(openSection, { toggle: false }).hide();
                        }
                    });
                });
            });

        });
    </script>
    </div>

</body>

</html>